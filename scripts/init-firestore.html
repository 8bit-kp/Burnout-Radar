<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Initialize Firestore Collections</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #1f2937; margin-top: 0; }
    .step {
      background: #f0f9ff;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid #3b82f6;
      border-radius: 4px;
    }
    .success {
      background: #f0fdf4;
      border-left-color: #10b981;
      color: #065f46;
    }
    .error {
      background: #fef2f2;
      border-left-color: #ef4444;
      color: #991b1b;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover { background: #2563eb; }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    #log {
      background: #1f2937;
      color: #f9fafb;
      padding: 15px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .log-line { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ðŸ”§ Initialize Firestore Collections</h1>
    
    <div class="step">
      <h3>Step 1: Enable Firestore</h3>
      <p>First, make sure Firestore is enabled in your Firebase Console:</p>
      <ol>
        <li>Go to <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
        <li>Select project: <strong>questsync-b61e4</strong></li>
        <li>Click <strong>Firestore Database</strong> in left menu</li>
        <li>Click <strong>Create database</strong> (if needed)</li>
        <li>Choose production mode and a location</li>
        <li>Wait for it to finish setting up</li>
      </ol>
    </div>

    <div class="step">
      <h3>Step 2: Initialize Collections</h3>
      <p>Click the button below to create sample documents in Firestore:</p>
      <button onclick="initializeCollections()" id="initBtn">Initialize Collections</button>
    </div>

    <div id="log"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Your Firebase config (from .env.local)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "questsync-b61e4",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const line = document.createElement('div');
      line.className = 'log-line';
      
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ðŸ“';
      
      line.textContent = `[${timestamp}] ${icon} ${message}`;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    window.initializeCollections = async function() {
      const btn = document.getElementById('initBtn');
      btn.disabled = true;
      btn.textContent = 'Initializing...';
      
      document.getElementById('log').innerHTML = '';
      log('Starting Firestore initialization...');

      try {
        // Create journals collection
        log('Creating journals collection...');
        const journalRef = await addDoc(collection(db, 'journals'), {
          userId: 'sample_init',
          date: '2025-01-01',
          text: 'Sample journal entry - you can delete this from Firebase Console',
          createdAt: new Date(),
          _sample: true
        });
        log(`Journals collection created! Doc ID: ${journalRef.id}`, 'success');

        // Create analytics collection
        log('Creating analytics collection...');
        const analyticsRef = await addDoc(collection(db, 'analytics'), {
          userId: 'sample_init',
          analyticsJSON: {
            cognitivePerformance: {
              cognitiveClarity: {
                score: 50,
                trend: 'stable',
                summary: 'Sample analytics data',
                relativeToBaseline: 0
              }
            }
          },
          createdAt: new Date(),
          _sample: true
        });
        log(`Analytics collection created! Doc ID: ${analyticsRef.id}`, 'success');

        log('âœ¨ All collections initialized successfully!', 'success');
        log('Check Firebase Console > Firestore Database to see them');
        log('You can now delete the sample documents (they have _sample: true)');
        
        btn.textContent = 'âœ“ Done!';
        btn.style.background = '#10b981';

      } catch (error) {
        log(`Error: ${error.message}`, 'error');
        log('Make sure Firestore is enabled in Firebase Console!', 'error');
        
        btn.disabled = false;
        btn.textContent = 'Try Again';
      }
    };
  </script>
</body>
</html>
